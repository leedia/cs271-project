<!DOCTYPE html>

<html>
  <head>
    
    <title>EEG-Decisions</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js" integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg==" crossorigin=""></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  </head>

  <body>

    <div id="mapid" style="width: 600px; height: 400px;"></div>
    <script>

      $.get('data/location.csv', function(data) {

        function csvToArray(csvString) {

          // The array we're going to build
          var csvArray = [];
          // Break it into rows to start
          var csvRows = csvString.split(/\n/);
          // Take off the first line to get the headers, then split that into an array
          var csvHeaders = csvRows.shift().split(',');
          // Loop through remaining rows
          for (var rowIndex = 0; rowIndex < csvRows.length-1; ++rowIndex) {
            var rowArray = csvRows[rowIndex].split(',');
            // Create a new row object to store our data.
            var rowObject = csvArray[rowIndex] = {};
            // Then iterate through the remaining properties and use the headers as keys
            for (var propIndex = 0; propIndex < rowArray.length; ++propIndex) {
              // Grab the value from the row array we're looping through...
              var propValue = rowArray[propIndex];
              // ...also grab the relevant header (the RegExp in both of these removes quotes)
              var propLabel = csvHeaders[propIndex];
              rowObject[propLabel] = propValue;
            }
          }
          return csvArray;
        }

        // Multiple Markers
        var latlngs = [];

        data = csvToArray(data);
        data.forEach(function(item) {
          console.log(parseFloat(item.latitude))
          latlngs.push([parseFloat(item.latitude), parseFloat(item.longitude)]);
        });

        var map = L.map('mapid').setView([42.374208, -71.116687], 13);

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
          maxZoom: 18,
          attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
            '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
            'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
          id: 'mapbox.streets'
        }).addTo(map);

        L.marker([42.374208, -71.116687]).addTo(map)
          .bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();

        var polyline = L.polyline(latlngs, {color: 'red', opacity: 0.3}).addTo(map);
        // zoom the map to the polyline
        map.fitBounds(polyline.getBounds());

        var popup = L.popup();

        function onMapClick(e) {
          popup
            .setLatLng(e.latlng)
            .setContent("You clicked the map at " + e.latlng.toString())
            .openOn(map);
        }

        map.on('click', onMapClick);

      });

    </script>



  </body>
</html>
